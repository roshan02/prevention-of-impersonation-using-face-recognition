<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta content="stuff, to, help, search, engines, not" name="keywords">
<meta content="What this page is about." name="description">
<meta content="Display Webcam Stream" name="title">
<title>Display Webcam Stream</title>
  
<style>
#container {
    margin: 0px 15%;
    width: 400px;
    height: 300px;
    border: 10px #333 solid;
}
#videoElement {
    width: 100%;
    height: 100%;
    background-color: #666;
}
.panel-heading {
background: #f5f5f5;}

#container {
	float:left;
}
canvas {
    margin-left: 0%;
    //float: left;
    //position: absolute;
    margin-top: 0%;
}
#frm {
	margin-left: 35%;
	//position: absolute;
	//float: right;
}
#snap{
	margin-left: 47%;
	//float: left;
	//margin-left: 0%;
}
#mis{
	padding-left: 0vw;
}
</style>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

</head>
  
<body>
<div class="panel-heading text-center panel-relative">
    <h2>Impersonation System</h2>
  </div>
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="#">WebSiteName</a>
    </div>
    <ul class="nav navbar-nav">
      <li class="active"><a href="#">Home</a></li>
      <li><a href="#">Page 1</a></li>
      <li><a href="#">Page 2</a></li>
      <li><a href="#">Page 3</a></li>
    </ul>
  </div>
</nav>


<div id="container">
    <video autoplay="true" id="videoElement" name = "abc">
     
    </video>
<br>
<br>
<br>

</div>

<canvas width="150px" height="100px" alt ='img' id = "canvas1" name="snapshot"></canvas>
<button id="snap" onclick="snap(); geturl()">Take screenshot</button>
<div id="frm">
	
	<form method="POST" action={% url 'index'%} class="form-group">
		{% csrf_token %}
		<br><br>
		Enter Your MIS here: <input type="text" name="mis" value="MIS" id="mis">	
		<input type="text" name="image" id="image" value="roshan" style="visibility: hidden">
		<input type="submit" value="Submit" />
	</form>

</div>


<br>
<!--<form method="GET">
    Question: <input type="text" name="search"><br/>
    Name: <input type="text" name="name"><br/>
    <input type="submit" value="Submit" />
</form><br/><br/>
-->
<script>
var canvas = document.querySelector('canvas');
		// Get a handle on the 2d context of the canvas element
		var context = canvas.getContext('2d');
		// Define some vars required later
		var w, h, ratio;
var video = document.querySelector("#videoElement");
 
navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;
 
if (navigator.getUserMedia) {       
    navigator.getUserMedia({video: true}, handleVideo, videoError);
}
 
function handleVideo(stream) {
    video.src = window.URL.createObjectURL(stream);

}
 
function videoError(e) {
    // do something
}

// Add a listener to wait for the 'loadedmetadata' state so the video's dimensions can be read
		video.addEventListener('loadedmetadata', function() {
			// Calculate the ratio of the video's width to height
			ratio = video.videoWidth / video.videoHeight;
			// Define the required width as 100 pixels smaller than the actual video's width
			w = video.videoWidth - 100;
			// Calculate the height based on the video's width and the ratio
			h = parseInt(w / ratio, 10);
			// Set the canvas width and height to the values just calculated
			canvas.width = w;
			canvas.height = h;			
		}, false);

function snap() {
			// Define the size of the rectangle that will be filled (basically the entire element)
			context.fillRect(0, 0, 400, 300);
			// Grab the image from the video
			context.drawImage(video, 0, 0, 400, 300);
		}
function geturl() {
var canvas = document.getElementById('canvas1');
var dataURL = canvas.toDataURL("image/png");
document.getElementById("image").value = dataURL;
//document.getElementById("image").innerHTML = dataURL;
}


/*$.ajax({
  type: "GET",
  url: "/ajax/index/",
  data: { 
     imgBase64: dataURL
  }
}).done(function(o) {
  console.log('saved'); 
  // If you want the file to be visible in the browser 
  // - please modify the callback in javascript. All you
  // need is to return the url to the file, you just saved 
  // and than put the image in your browser.
});
*/
</script>
<p name="dataurl" id = "url"></p>
</body>
</html>
